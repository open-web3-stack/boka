// generated by polka.codes
// Platform-specific JIT operations helper

import Foundation
import TracingUtils
import Utils

// TODO: Implement JITPlatformStrategy protocol and platform-specific implementations
// TODO: Add support for additional platforms beyond macOS and Linux

enum JITPlatformHelper {
    private static let logger = Logger(label: "JITPlatformHelper")

    private static func createPlatformStrategy() throws -> JITPlatformStrategy {
        #if os(macOS)
            logger.debug("Creating MacOSJITPlatformStrategy.")
            return MacOSJITPlatformStrategy()
        #elseif os(Linux)
            logger.debug("Creating LinuxJITPlatformStrategy.")
            return LinuxJITPlatformStrategy()
        #else
            let currentOS = ProcessInfo.processInfo.operatingSystemVersionString
            logger.error("JIT running on an unsupported operating system: \(currentOS).")
            throw JITError.targetArchUnsupported(arch: "Unsupported OS: \(currentOS)")
        #endif
    }

    static func getCurrentTargetArchitecture(config: PvmConfig) throws -> String {
        let strategy = try createPlatformStrategy()
        return try strategy.getCurrentTargetArchitecture(config: config)
    }
}
