// generated by polka.codes
// This file implements the JITPlatformStrategy for macOS.

import Foundation
import TracingUtils
import Utils // For PvmConfig, JITError, Logger

// TODO: Ensure PvmConfig, JITError, Logger are accessible.

struct MacOSJITPlatformStrategy: JITPlatformStrategy {
    private let logger = Logger(label: "MacOSJITPlatformStrategy")

    func getCurrentTargetArchitecture(config _: PvmConfig) throws -> String {
        // Auto-detect native architecture for macOS
        #if arch(arm64) && os(macOS)
            logger.debug("Auto-detected JIT target architecture for macOS: aarch64-apple-darwin")
            return "aarch64-apple-darwin"
        #elseif arch(x86_64) && os(macOS) // For Intel Macs
            logger.debug("Auto-detected JIT target architecture for macOS: x86_64-apple-darwin")
            return "x86_64-apple-darwin"
        #else
            let currentArch = "\(ProcessInfo.processInfo.machineHardwareName ?? "unknown arch") on macOS"
            logger
                .error(
                    "JIT running on an unsupported macOS architecture for automatic detection: \(currentArch)."
                )
            throw JITError.targetArchUnsupported(arch: "macOS: \(currentArch)")
        #endif
    }
}
