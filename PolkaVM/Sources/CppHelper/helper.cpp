// generated by polka.codes
#include "helper.hh"
#include <stdio.h>
#include <cstring>

// C++ Trampoline for calling the Swift host function dispatcher
// This function is called by the JIT-generated code.
// It's declared in helper.hh and defined here.
uint32_t pvm_host_call_trampoline(
    JITHostFunctionTable* host_table,
    uint32_t host_call_index,
    uint64_t* guest_registers_ptr,
    uint8_t* guest_memory_base_ptr,
    uint32_t guest_memory_size,
    uint64_t* guest_gas_ptr) {

    if (!host_table || !host_table->dispatchHostCall) {
        // TODO: Log error - host table or dispatch function is null.
        // This indicates a setup problem.
        // Return a specific error code that the JIT epilogue can interpret as a VM panic.
        // For now, using a magic number. This should align with PolkaVM's ExitReason.PanicReason.
        return 0xFFFFFFFF; // Placeholder for HostFunctionError or similar
    }

    // Call the Swift function pointer
    return host_table->dispatchHostCall(
        host_table->ownerContext,
        host_call_index,
        guest_registers_ptr,
        guest_memory_base_ptr,
        guest_memory_size,
        guest_gas_ptr
    );
}
