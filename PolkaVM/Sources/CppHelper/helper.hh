// generated by polka.codes
// This header defines the CppHelper class, which provides C++ functionalities
// accessible from Swift, particularly for JIT compilation using AsmJit for AArch64 and x86_64.

#ifndef HELPER_HH
#define HELPER_HH

#include <cstddef>
#include <cstdint>

// Need to match JITHostFunctionFnSwift in ExecutorBackendJIT.swift
typedef uint32_t (* _Nonnull JITHostFunctionFn)(
	void* _Nonnull ownerContext,
	uint32_t hostCallIndex,
	uint64_t* _Nonnull guestRegisters,
	uint8_t* _Nonnull guestMemoryBase,
	uint32_t guestMemorySize,
	uint64_t* _Nonnull guestGas
);

// It's passed by pointer as the `invocationContext` to the JIT-compiled function.
struct JITHostFunctionTable {
    JITHostFunctionFn dispatchHostCall;

    // Opaque pointer to the Swift ExecutorBackendJIT instance.
    void *_Nonnull ownerContext;
};

// Declare the C++ Trampoline for calling the Swift host function dispatcher.
// This function is called by the JIT-generated code from either A64 or X64 implementations.

uint32_t pvm_host_call_trampoline(
    JITHostFunctionTable *_Nonnull host_table,
    uint32_t host_call_index,
    uint64_t *_Nonnull guest_registers_ptr,
    uint8_t *_Nonnull guest_memory_base_ptr,
    uint32_t guest_memory_size,
    uint64_t *_Nonnull guest_gas_ptr);

#endif // HELPER_HH
