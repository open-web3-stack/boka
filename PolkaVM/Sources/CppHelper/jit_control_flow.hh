// generated by polka.codes
// Label-based control flow instructions for JIT compilation
// Implements direct jumps for maximum performance

#pragma once

#include <asmjit/asmjit.h>
#include <cstdint>

// Forward declaration
namespace JIT {
    class LabelManager;
}

// Label-based control flow instruction implementations
// These functions emit jumps directly to labeled code blocks
// This is the most performant approach as documented in plans/docs/

namespace JIT {

// BranchEq: Branch if equal (register-register) with label support
// Emits conditional jump to target_label if registers are equal
// Otherwise execution continues to next instruction (fallthrough)
extern "C" bool jit_emit_branch_eq_labeled(
    void* _Nonnull assembler,
    const char* _Nonnull target_arch,
    uint8_t src1_reg,
    uint8_t src2_reg,
    asmjit::Label target_label
);

// BranchNe: Branch if not equal (register-register) with label support
// Emits conditional jump to target_label if registers are not equal
// Otherwise execution continues to next instruction (fallthrough)
extern "C" bool jit_emit_branch_ne_labeled(
    void* _Nonnull assembler,
    const char* _Nonnull target_arch,
    uint8_t src1_reg,
    uint8_t src2_reg,
    asmjit::Label target_label
);

// Unconditional jump to label
// Direct jump to target_label - no fallthrough
extern "C" bool jit_emit_jump_labeled(
    void* _Nonnull assembler,
    const char* _Nonnull target_arch,
    asmjit::Label target_label
);

// Load immediate and jump to label
// Combines LoadImm + Jump into single operation
extern "C" bool jit_emit_load_imm_jump_labeled(
    void* _Nonnull assembler,
    const char* _Nonnull target_arch,
    uint8_t dest_reg,
    uint32_t immediate,
    asmjit::Label target_label
);

// Indirect jump (JumpInd) - jumps to address in register
// Requires special handling via jump table or dispatcher
// This is the complex case that may need different approach
extern "C" bool jit_emit_jump_indirect_labeled(
    void* _Nonnull assembler,
    const char* _Nonnull target_arch,
    uint8_t reg_index,
    JIT::LabelManager* label_manager,
    const uint8_t* _Nonnull bytecode,
    uint32_t bytecode_size
);

} // namespace JIT
